<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>证书验证中心</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 40px; }
        .valid { color: green; }
        .invalid { color: red; }
        .result { font-size: 1.5em; margin-top: 20px; }
        .debug { font-size: 0.8em; color: gray; text-align: left; margin-top: 20px; display: none; }
    </style>
</head>
<body>
    <h1>🗃️ 开发者贡献证书验证系统</h1>
    <p>请输入证书上的哈希码，或直接扫描证书二维码进行验证。</p>

    <div id="app">
        <input type="text" id="hashInput" placeholder="请输入证书哈希码..." style="width: 400px; padding: 10px;">
        <button onclick="checkHash()">验证</button>
        <div id="result"></div>
        <div id="debugInfo" class="debug"></div>
    </div>

    <script>
        // 从URL中获取哈希参数
        const urlParams = new URLSearchParams(window.location.search);
        const hashFromUrl = urlParams.get('hash');
        if (hashFromUrl) {
            document.getElementById('hashInput').value = hashFromUrl;
            checkHash();
        }

        async function checkHash() {
            const inputHash = document.getElementById('hashInput').value.trim();
            const resultDiv = document.getElementById('result');
            const debugDiv = document.getElementById('debugInfo');
            
            // 显示调试信息
            debugDiv.style.display = 'block';
            debugDiv.innerHTML = "<p>开始请求...</p>";
            
            if (!inputHash) {
                resultDiv.innerHTML = "<p class='invalid'>请输入哈希码</p>";
                return;
            }

            resultDiv.innerHTML = "<p>正在验证...</p>";

            // 尝试直接访问（不使用代理）
            const verificationFileURL = 'https://raw.githubusercontent.com/soulferryman/Contributors/main/verification.json';
            debugDiv.innerHTML += `<p>请求URL: ${verificationFileURL}</p>`;

            try {
                const response = await fetch(verificationFileURL);
                debugDiv.innerHTML += `<p>响应状态: ${response.status} ${response.statusText}</p>`;
                
                if (!response.ok) {
                    throw new Error(`HTTP错误: ${response.status}`);
                }
                
                const text = await response.text();
                debugDiv.innerHTML += `<p>响应内容: <pre>${text.substring(0, 200)}...</pre></p>`;
                
                const data = JSON.parse(text);
                debugDiv.innerHTML += `<p>JSON解析成功</p>`;

                // 检查输入的哈希是否存在于JSON数组中
                const found = data.find(entry => entry.hash === inputHash);

                if (found) {
                    resultDiv.innerHTML = `
                        <div class="valid">
                            <h2>✅ 证书有效！</h2>
                            <p>此证书颁发给：<strong>${found.github_username}</strong></p>
                            <p>贡献等级：<strong>${found.level}</strong></p>
                            <p>颁发日期：<strong>${found.date_issued}</strong></p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="invalid">
                            <h2>❌ 证书无效</h2>
                            <p>未能找到与该哈希值匹配的证书记录。此证书可能为伪造或未被登记。</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error("Fetch error:", error);
                debugDiv.innerHTML += `<p>错误详情: ${error.message}</p>`;
                resultDiv.innerHTML = `
                    <div class="invalid">
                        <h2>⚠️ 验证服务暂时不可用</h2>
                        <p>请稍后再试。错误详情: ${error.message}</p>
                        <p>请检查控制台获取更多信息。</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
