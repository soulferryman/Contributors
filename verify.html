<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>证书验证中心</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 40px; }
        .valid { color: green; }
        .invalid { color: red; }
        .result { font-size: 1.5em; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>🗃️ 开发者贡献证书验证系统</h1>
    <p>请输入证书上的哈希码，或直接扫描证书二维码进行验证。</p>

    <div id="app">
        <input type="text" id="hashInput" placeholder="请输入证书哈希码..." style="width: 400px; padding: 10px;">
        <button onclick="checkHash()">验证</button>
        <div id="result"></div>
    </div>

   <script>
    // 从URL中获取哈希参数（如果用户是扫描二维码过来的）
    const urlParams = new URLSearchParams(window.location.search);
    const hashFromUrl = urlParams.get('hash');
    if (hashFromUrl) {
        document.getElementById('hashInput').value = hashFromUrl;
        checkHash();
    }

    async function checkHash() {
        const inputHash = document.getElementById('hashInput').value.trim();
        const resultDiv = document.getElementById('result');
        
        if (!inputHash) {
            resultDiv.innerHTML = "<p class='invalid'>请输入哈希码</p>";
            return;
        }

        resultDiv.innerHTML = "<p>正在验证...</p>";

        // 使用CORS代理访问Raw GitHub Content
        const proxyUrl = 'https://api.codetabs.com/v1/proxy?quest=';
        const targetUrl = 'https://raw.githubusercontent.com/你的用户名/你的仓库名/main/verification.json';
        const verificationFileURL = proxyUrl + encodeURIComponent(targetUrl);

        try {
            const response = await fetch(verificationFileURL);
            
            if (!response.ok) {
                throw new Error(`网络响应不正常: ${response.status}`);
            }
            
            const data = await response.json();

            // 检查输入的哈希是否存在于JSON数组中
            const found = data.find(entry => entry.hash === inputHash);

            if (found) {
                resultDiv.innerHTML = `
                    <div class="valid">
                        <h2>✅ 证书有效！</h2>
                        <p>此证书颁发给：<strong>${found.github_username}</strong></p>
                        <p>贡献等级：<strong>${found.level}</strong></p>
                        <p>颁发日期：<strong>${found.date_issued}</strong></p>
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="invalid">
                        <h2>❌ 证书无效</h2>
                        <p>未能找到与该哈希值匹配的证书记录。此证书可能为伪造或未被登记。</p>
                    </div>
                `;
            }
        } catch (error) {
            console.error("Fetch error:", error);
            resultDiv.innerHTML = `
                <div class="invalid">
                    <h2>⚠️ 验证服务暂时不可用</h2>
                    <p>请稍后再试。错误详情: ${error.message}</p>
                </div>
            `;
        }
    }
</script>
</body>
</html>
